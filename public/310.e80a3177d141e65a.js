"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[310],{5310:(L,m,_)=>{_.r(m),_.d(m,{default:()=>Q});var g=_(6814),f=_(7818),h=_(4055),d=_(95),C=_(4104),M=_(3519),x=_.n(M),e=_(5879),b=_(2670),P=_(2425);function A(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"th",11),e._uU(2),e.qZA(),e.TgZ(3,"th",11),e._uU(4),e.qZA(),e.TgZ(5,"th",11),e._uU(6),e.qZA(),e.TgZ(7,"th",11),e._uU(8),e.qZA(),e.BQk()),2&a){const o=c.$implicit,n=e.oxw().$implicit;e.xp6(2),e.Oqu("Plan "+o.Mes+" - "+n.Anio),e.xp6(2),e.Oqu(o.Mes+" - "+n.Anio),e.xp6(2),e.Oqu("Diferencia "),e.xp6(2),e.Oqu("% Variaci\xf3n ")}}function S(a,c){if(1&a&&(e.ynx(0),e.YNc(1,A,9,4,"ng-container",10),e.BQk()),2&a){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.Meses)}}function E(a,c){if(1&a&&(e.TgZ(0,"div",23),e._uU(1),e.qZA()),2&a){e.oxw();const o=e.MAs(7),n=e.oxw(3).$implicit,i=e.oxw();e.xp6(1),e.Oqu(i.verifyValue(n.Tipo,o.value)[0].Mensaje)}}function O(a,c){1&a&&e._UZ(0,"i",24)}function T(a,c){if(1&a){const o=e.EpF();e.ynx(0),e.TgZ(1,"td",16),e.YNc(2,E,2,1,"div",17),e.TgZ(3,"div",18)(4,"span",19),e._uU(5,"$"),e.qZA(),e.TgZ(6,"input",20,21),e.NdJ("input",function(){e.CHM(o);const i=e.MAs(7),t=e.oxw(3).$implicit,s=e.oxw();return e.KtG(s.verifyValue(t.Tipo,i.value))})("keyup.enter",function(){e.CHM(o);const i=e.MAs(7),t=e.oxw().$implicit,s=e.oxw().$implicit,r=e.oxw().$implicit,l=e.oxw();return e.KtG(l.guardarValorPlan(s.Anio,t.Mes,r.id,i.value,r.Tipo))}),e.qZA()()(),e.TgZ(8,"td",16),e._uU(9),e.ALo(10,"number"),e.YNc(11,O,1,0,"i",22),e.qZA(),e.BQk()}if(2&a){const o=e.MAs(7),n=e.oxw().$implicit,i=e.oxw().$implicit,t=e.oxw().$implicit,s=e.oxw();e.xp6(2),e.Q6J("ngIf",0==s.verifyValue(t.Tipo,o.value)[0].Estado),e.xp6(4),e.Q6J("value",s.getValuePlan(t.id,n.Mes,i.Anio)),e.xp6(3),e.hij(" ","$ "+e.lcZ(10,4,s.getValorCategoria(t.id,n.Mes,i.Anio))," "),e.xp6(2),e.Q6J("ngIf",2==t.Tipo&&s.getValorCategoria(t.id,n.Mes,i.Anio)<s.getValuePlan(t.id,n.Mes,i.Anio))}}function N(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"td",16),e._uU(2),e.ALo(3,"number"),e.qZA(),e.TgZ(4,"td",16),e._uU(5),e.ALo(6,"number"),e.qZA(),e.BQk()),2&a){const o=e.oxw().$implicit,n=e.oxw().$implicit,i=e.oxw().$implicit,t=e.oxw();e.xp6(2),e.Oqu("$ "+e.lcZ(3,2,t.getValuePlanFlujo(i.Categorias,o.Mes,n.Anio))),e.xp6(3),e.Oqu("$ "+e.lcZ(6,4,t.getValueCategoria(i.Categorias,o.Mes,n.Anio)))}}function F(a,c){if(1&a&&(e.TgZ(0,"td",16),e._uU(1),e.ALo(2,"number"),e.qZA()),2&a){const o=e.oxw().$implicit,n=e.oxw().$implicit,i=e.oxw().$implicit,t=e.oxw();e.xp6(1),e.Oqu("$ "+e.lcZ(2,1,t.calcularDiferencia(i.id,o.Mes,n.Anio)))}}function V(a,c){if(1&a&&(e.TgZ(0,"td",16),e._uU(1),e.ALo(2,"number"),e.qZA()),2&a){const o=e.oxw().$implicit,n=e.oxw().$implicit,i=e.oxw().$implicit,t=e.oxw();e.xp6(1),e.Oqu("$ "+e.lcZ(2,1,t.calcularDiferenciaFlujos(i.Categorias,o.Mes,n.Anio)))}}function Z(a,c){1&a&&e._UZ(0,"i",27)}function w(a,c){1&a&&e._UZ(0,"i",28)}function R(a,c){if(1&a&&(e.TgZ(0,"td",16),e._uU(1),e.ALo(2,"number"),e.ALo(3,"number"),e.YNc(4,Z,1,0,"i",25),e.YNc(5,w,1,0,"i",26),e.qZA()),2&a){const o=e.oxw().$implicit,n=e.oxw().$implicit,i=e.oxw().$implicit,t=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,3,e.lcZ(3,6,t.calcularMargen(i.id,o.Mes,n.Anio)),"1.0-2")+" %"," "),e.xp6(3),e.Q6J("ngIf",t.calcularMargen(i.id,o.Mes,n.Anio)<=0),e.xp6(1),e.Q6J("ngIf",t.calcularMargen(i.id,o.Mes,n.Anio)>0)}}function U(a,c){1&a&&e._UZ(0,"i",27)}function v(a,c){1&a&&e._UZ(0,"i",28)}function B(a,c){if(1&a&&(e.TgZ(0,"td",16),e._uU(1),e.ALo(2,"number"),e.ALo(3,"number"),e.YNc(4,U,1,0,"i",25),e.YNc(5,v,1,0,"i",26),e.qZA()),2&a){const o=e.oxw().$implicit,n=e.oxw().$implicit,i=e.oxw().$implicit,t=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,3,e.lcZ(3,6,t.calcularMargenFlujos(i.Categorias,o.Mes,n.Anio)),"1.0-2")+" %"," "),e.xp6(3),e.Q6J("ngIf",t.calcularMargenFlujos(i.Categorias,o.Mes,n.Anio)<=0),e.xp6(1),e.Q6J("ngIf",t.calcularMargenFlujos(i.Categorias,o.Mes,n.Anio)>0)}}function y(a,c){if(1&a&&(e.ynx(0),e.YNc(1,T,12,6,"ng-container",14),e.YNc(2,N,7,6,"ng-container",14),e.YNc(3,F,3,3,"td",15),e.YNc(4,V,3,3,"td",15),e.YNc(5,R,6,8,"td",15),e.YNc(6,B,6,8,"td",15),e.BQk()),2&a){const o=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",0==o.Calculado),e.xp6(1),e.Q6J("ngIf",1==o.Calculado),e.xp6(1),e.Q6J("ngIf",0==o.Calculado),e.xp6(1),e.Q6J("ngIf",1==o.Calculado),e.xp6(1),e.Q6J("ngIf",0==o.Calculado),e.xp6(1),e.Q6J("ngIf",1==o.Calculado)}}function I(a,c){if(1&a&&(e.ynx(0),e.YNc(1,y,7,6,"ng-container",10),e.BQk()),2&a){const o=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",o.Meses)}}const J=function(a){return{"cabecera-categoria":a}},D=function(a,c){return{"cabecera-categoria":a,"cabecera-categoria-no-calc":c}};function $(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"tr",12)(2,"td",12)(3,"span",13),e._uU(4),e.qZA()(),e.YNc(5,I,2,1,"ng-container",10),e.qZA(),e.BQk()),2&a){const o=c.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(4,J,o.Calculado)),e.xp6(1),e.Q6J("ngClass",e.WLB(6,D,o.Calculado,!o.Calculado)),e.xp6(2),e.Oqu(o.Nombre),e.xp6(1),e.Q6J("ngForOf",n.Anios)}}let Q=(()=>{class a{constructor(o,n){this.conS=o,this.toastr=n,this.CuentasBanco=[],this.CuentasBancoSelect=[],this.Sucursales=[],this.SucursalesSelect=[],this.Usuarios=[],this.UsuariosSelect=[],this.Meses=[],this.Categorias=[],this.Registros=[],this.MesesSeleccionados=[],this.Anios=[],this.AniosSeleccionados=[],this.AniosRegistrosBack=[],this.MesesRegistrosBack=[],this.RegistrosBack=[],this.RegistrosValoresPlanes=[],this.ValorPlan=new d.NI(0)}ngOnInit(){this.usuario=JSON.parse(localStorage.getItem("usuarioFinancialSystems")),this.Anios=[{Anio:2023},{Anio:2024}],this.Meses=[{Mes:"Enero",NumMes:1,seleccionado:!1},{Mes:"Febrero",NumMes:2,seleccionado:!1},{Mes:"Marzo",NumMes:3,seleccionado:!1},{Mes:"Abril",NumMes:4,seleccionado:!1},{Mes:"Mayo",NumMes:5,seleccionado:!1},{Mes:"Junio",NumMes:6,seleccionado:!1},{Mes:"Julio",NumMes:7,seleccionado:!1},{Mes:"Agosto",NumMes:8,seleccionado:!1},{Mes:"Septiembre",NumMes:9,seleccionado:!1},{Mes:"Octubre",NumMes:10,seleccionado:!1},{Mes:"Noviembre",NumMes:11,seleccionado:!1},{Mes:"Diciembre",NumMes:12,seleccionado:!1}],this.MesesRegistrosBack=this.Meses,this.AniosRegistrosBack=this.Anios,this.obtenerValoresPlanes(),this.ObtenerCuentasBanco(),this.obtenerCategorias(),this.obtenerSucursales(),this.obtenerUsuarios()}filtrarData(){let o=[],n=[],i=[],t=[],s=[];this.MesesSeleccionados.length>0?(this.MesesSeleccionados.forEach(r=>{n.push(r.Mes)}),this.Meses=this.MesesSeleccionados):this.Meses=this.MesesRegistrosBack,this.AniosSeleccionados.length>0?(this.AniosSeleccionados.forEach(r=>{o.push(r.Anio)}),this.Anios=this.AniosSeleccionados):this.Anios=this.AniosRegistrosBack,this.CuentasBancoSelect.length>0&&this.CuentasBancoSelect.forEach(r=>{i.push(r.Cuenta)}),this.UsuariosSelect.length>0&&this.UsuariosSelect.forEach(r=>{t.push(r.Usuario)}),this.SucursalesSelect.length>0&&this.SucursalesSelect.forEach(r=>{s.push(r.id)}),this.Criterios={MesRegistro:n,AnioRegistro:o,NumCuenta:i,Usuario:t,idSucursal:s},this.Registros=this.conS.filtradoDinamico(this.Criterios,this.RegistrosBack)}ObtenerCuentasBanco(){this.conS.obtenerBancos(this.usuario.idEmpresa).subscribe(o=>{this.CuentasBanco=o})}obtenerSucursales(){this.conS.obtenerSucursales(this.usuario.idEmpresa).subscribe(o=>{this.Sucursales=o})}obtenerUsuarios(){this.conS.obtenerUsuarios(this.usuario.idEmpresa).subscribe(o=>{this.Usuarios=o})}obtenerCategorias(){this.conS.obtenerCategoriasFlujos().subscribe(o=>{this.Categorias=o,this.obtenerRegistros()})}obtenerRegistros(){this.conS.obtenerRegistros(this.usuario.idEmpresa).subscribe(o=>{o.sort((n,i)=>i.Orden-n.Orden).forEach(n=>{this.Registros.push({Activo:n.Activo,AnioRegistro:n.AnioRegistro,Cuenta:n.Cuenta,Editando:n.Editando,Elemento:n.Elemento,FechaRegistro:n.FechaRegistro,MesRegistro:n.MesRegistro,Nuevo:n.Nuevo,NumMes:n.NumMes,NumSemana:n.NumSemana,Orden:n.Orden,Semana:n.Semana,Valor:n.Valor,id:n.id,Tipo:n.Tipo||"",idCategoria:n.idCategoria,idEmpresa:n.idEmpresa,idFlujo:n.idFlujo,idUsuario:n.idUsuario,idMatriz:n.idMatriz,idSocioNegocio:n.idSocioNegocio,idSucursal:n.idSucursal,NombreElemento:n.Elemento.label||"",idElemento:n.Elemento.id||"",NumCuenta:n.Cuenta.Cuenta||"",CategoriaNombre:n.idCategoria.Nombre||"",SocioNegocio:n.idSocioNegocio.Nombre||""})}),this.RegistrosBack=this.Registros})}getValorCategoria(o,n,i){let t=[],s=0;return t=this.Registros.filter(r=>r.idCategoria.id==o&&r.MesRegistro==n&&r.AnioRegistro==i),t.length>0?t.forEach(r=>{s+=r.Valor}):s=0,s}getTableClass(){return 1===this.AniosSeleccionados.length&&1===this.MesesSeleccionados.length?"table table-100 table-reduced":"table table-100"}obtenerValoresPlanes(){this.conS.obtenerValoresPlanes(this.usuario.idEmpresa).subscribe(o=>{this.RegistrosValoresPlanes=o})}formatNumber(o){return o.toLocaleString().replace(/\./g,",")}formatearValor(o){return o.toLocaleString("es-ES")}getValuePlan(o,n,i){let t=[];return t=this.RegistrosValoresPlanes.filter(s=>s.idCategoria==o&&s.MesRegistro==n&&s.AnioRegistro==i&&s.idEmpresa==this.usuario.idEmpresa&&s.IdSucursal==this.usuario.IdSucursal),t.length>0?t[0].Valor:0}getValuePlanFlujo(o,n,i){let t=[],s=0;const r=o.map(l=>l.idCategoria);return t=this.RegistrosValoresPlanes.filter(l=>r.includes(l.idCategoria)&&l.MesRegistro==n&&l.AnioRegistro==i&&l.idEmpresa==this.usuario.idEmpresa&&l.IdSucursal==this.usuario.IdSucursal),t.length>0?t.forEach(l=>{s+=Number(l.Valor)}):s=0,s}verifyValue(o,n){return 2==o&&Number(n)>0?[{Estado:!1,Mensaje:"El valor debe ser negativo"}]:1==o&&Number(n)<0?[{Estado:!1,Mensaje:"El valor debe ser positivo"}]:[{Estado:!0,Mensaje:"Excelente"}]}getValueCategoria(o,n,i){let t=[],s=0;const r=o.map(l=>l.idCategoria);return t=this.Registros.filter(l=>r.includes(l.idCategoria.id)&&l.MesRegistro==n&&l.AnioRegistro==i&&l.idEmpresa==this.usuario.idEmpresa),t.length>0?t.forEach(l=>{s+=l.Valor}):s=0,s}guardarValorPlan(o,n,i,t,s){if(0==this.verifyValue(s,Number(t))[0].Estado)x().fire({position:"center",icon:"warning",title:`${this.verifyValue(s,Number(t))[0].Mensaje}`,showConfirmButton:!1,timer:1500});else{let r=this.getValorCategoria(i,n,o),l=r/=t,k={AnioRegistro:o,MesRegistro:n,idCategoria:i,Valor:Number(t),ValorMargen:Number(l.toFixed(2)),idEmpresa:this.usuario.idEmpresa,IdSucursal:this.usuario.IdSucursal},p=[];p=this.RegistrosValoresPlanes.filter(u=>u.idCategoria==i&&u.MesRegistro==n&&u.AnioRegistro==o&&u.idEmpresa==this.usuario.idEmpresa&&u.IdSucursal==this.usuario.IdSucursal),p.length>0?(p[0].Valor=Number(t),p[0].ValorMargen=r/=Number(t),this.conS.ActualizarValorPlan(p[0]).then(u=>{this.toastr.success("Guardado","\xa1Exito!")})):this.conS.crearValorPlan(k).then(u=>{this.toastr.success("Guardado","\xa1Exito!")})}}calcularDiferencia(o,n,i){return this.getValorCategoria(o,n,i)-this.getValuePlan(o,n,i)}calcularDiferenciaFlujos(o,n,i){return this.getValueCategoria(o,n,i)-this.getValuePlanFlujo(o,n,i)}calcularMargen(o,n,i){let t=this.getValorCategoria(o,n,i),s=this.getValuePlan(o,n,i);return 0==t||0==s?0:100*(t/s-1)}calcularMargenFlujos(o,n,i){let t=this.getValueCategoria(o,n,i),s=this.getValuePlanFlujo(o,n,i);return 0==t||0==s?0:100*(t/s-1)}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(b.e),e.Y36(P._W))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-planeacion-financiera"]],standalone:!0,features:[e.jDz],decls:14,vars:14,consts:[["display","chip","placeholder","A\xf1os","optionLabel","Anio",1,"m-1",3,"options","ngModel","onChange","ngModelChange"],["display","chip","placeholder","Meses","optionLabel","Mes",1,"m-1",3,"options","ngModel","onChange","ngModelChange"],["display","chip","placeholder","Cuentas","optionLabel","Cuenta",1,"m-1",3,"options","ngModel","onChange","ngModelChange"],["display","chip","placeholder","Usuarios","optionLabel","Nombres",1,"m-1",3,"options","ngModel","onChange","ngModelChange"],["display","chip","placeholder","Sucursales","optionLabel","Nombre",1,"m-1",3,"options","ngModel","onChange","ngModelChange"],[1,"container-table"],[1,"table-responsive","mt-3"],[1,"table","table-100"],[1,"cabecera"],[1,"text-left",2,"padding","0.5rem","background-color","#0c8c86","text-transform","uppercase"],[4,"ngFor","ngForOf"],[1,"text-center",2,"padding","0.7rem","font-weight","500","text-transform","uppercase"],[3,"ngClass"],[1,"categoria-toggle"],[4,"ngIf"],["class","text-center",4,"ngIf"],[1,"text-center"],["class","animate__animated animate__bounceIn custom-alert shadow-1","style","color: red; font-size: 11px;",4,"ngIf"],[1,"input-group"],[1,"class-2"],["type","number","aria-label","Amount (to the nearest dollar)",1,"form-control",3,"value","input","keyup.enter"],["Valor",""],["class","fa-solid fa-circle-exclamation text-danger",4,"ngIf"],[1,"animate__animated","animate__bounceIn","custom-alert","shadow-1",2,"color","red","font-size","11px"],[1,"fa-solid","fa-circle-exclamation","text-danger"],["class","fas fa-arrow-down text-danger",4,"ngIf"],["class","fas fa-arrow-up text-success",4,"ngIf"],[1,"fas","fa-arrow-down","text-danger"],[1,"fas","fa-arrow-up","text-success"]],template:function(o,n){1&o&&(e.TgZ(0,"p-multiSelect",0),e.NdJ("onChange",function(){return n.filtrarData()})("ngModelChange",function(t){return n.AniosSeleccionados=t}),e.qZA(),e.TgZ(1,"p-multiSelect",1),e.NdJ("onChange",function(){return n.filtrarData()})("ngModelChange",function(t){return n.MesesSeleccionados=t}),e.qZA(),e.TgZ(2,"p-multiSelect",2),e.NdJ("onChange",function(){return n.filtrarData()})("ngModelChange",function(t){return n.CuentasBancoSelect=t}),e.qZA(),e.TgZ(3,"p-multiSelect",3),e.NdJ("onChange",function(){return n.filtrarData()})("ngModelChange",function(t){return n.UsuariosSelect=t}),e.qZA(),e.TgZ(4,"p-multiSelect",4),e.NdJ("onChange",function(){return n.filtrarData()})("ngModelChange",function(t){return n.SucursalesSelect=t}),e.qZA(),e.TgZ(5,"div",5)(6,"div",6)(7,"table",7)(8,"thead",8)(9,"th",9),e._uU(10,"Naturalezas"),e.qZA(),e.YNc(11,S,2,1,"ng-container",10),e.qZA(),e.TgZ(12,"tbody"),e.YNc(13,$,6,9,"ng-container",10),e.qZA()()()()),2&o&&(e.Q6J("options",n.AniosRegistrosBack)("ngModel",n.AniosSeleccionados),e.xp6(1),e.Q6J("options",n.MesesRegistrosBack)("ngModel",n.MesesSeleccionados),e.xp6(1),e.Q6J("options",n.CuentasBanco)("ngModel",n.CuentasBancoSelect),e.xp6(1),e.Q6J("options",n.Usuarios)("ngModel",n.UsuariosSelect),e.xp6(1),e.Q6J("options",n.Sucursales)("ngModel",n.SucursalesSelect),e.xp6(3),e.Tol(n.getTableClass()),e.xp6(4),e.Q6J("ngForOf",n.Anios),e.xp6(2),e.Q6J("ngForOf",n.Categorias))},dependencies:[g.ez,g.mk,g.sg,g.O5,g.JJ,f.m,d.JJ,d.On,h.q4,h.NU,C.EV],styles:['@charset "UTF-8";.negativo[_ngcontent-%COMP%]{color:red}.table-100[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-100[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{width:100%;min-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:100}th[_ngcontent-%COMP%]:first-child, td[_ngcontent-%COMP%]:first-child{position:sticky;left:0;z-index:2}.cabecera[_ngcontent-%COMP%]{color:#fff;background-color:#0c8c86;position:sticky;top:0;z-index:100}.categoria-toggle[_ngcontent-%COMP%]{cursor:pointer}.fa-square-minus[_ngcontent-%COMP%]:hover{color:#0c8c86}.categoria-toggle-icon[_ngcontent-%COMP%]{margin-left:5px}.cabecera-categoria[_ngcontent-%COMP%]{background-color:#ceecf0}.cabecera-flujo-efectivo-libre[_ngcontent-%COMP%]{background-color:#0c8c8633}.filters-buttons[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.filters-buttons[_ngcontent-%COMP%]   p-checkbox[_ngcontent-%COMP%]{margin-top:1rem}.container-table[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;min-width:100%;padding:1rem}.table[_ngcontent-%COMP%]{border:1px solid #e9ecef;align-self:start}.table-reduced[_ngcontent-%COMP%]{width:50%;align-self:start;table-layout:fixed}.cabecera[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{min-width:200px;max-width:200px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-direction:row;min-height:100%}.class-2[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;height:100%;text-align:center;background-color:#e5e7eb;font-size:18px;color:#0c8c86;padding:3.5px;flex-basis:8%;border-top-left-radius:8px;border-bottom-left-radius:8px}.form-control[_ngcontent-%COMP%]{padding-left:5px}.input-group-text[_ngcontent-%COMP%]{min-width:50px}.cabecera-categoria[_ngcontent-%COMP%]{background-color:#e0f7fa}.cabecera-categoria-no-calc[_ngcontent-%COMP%]{background-color:#fff}.text-center[_ngcontent-%COMP%]{text-align:center}']}),a})()}}]);