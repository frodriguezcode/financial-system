<div class="row">
  <div class="col-sm-12">
    <app-card cardTitle="Catálogo de Cuentas Contables" [options]="false">
<p-treeTable
  *ngIf="CatalogoCuentas.length > 0"
  [value]="CatalogoCuentas"
  (onNodeExpand)="onNodeExpand($event)"
  (onNodeCollapse)="onNodeCollapse($event)"
  [scrollable]="true"
  [tableStyle]="{ 'min-width': anchoTabla }"
>
  <ng-template pTemplate="header">
    <tr style="background-color: white">
      <th style="width: 30%">Nombre</th>
      <th style="width: 12%" class="text-center">Añadir Cuenta</th>
      <th style="width: 12%" class="text-center">Proyectos Asig.</th>
      <th style="width: 12%" class="text-center">Sucursales Asig.</th>
      <th style="width: 17%" class="text-center">Editar</th>
      <th style="width: 17%" class="text-center">Borrar</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
    <tr 
      [ngClass]="
        rowData.Tipo === 'Abuelo' ? 'fila-abuelo' : 
        rowData.Tipo === 'Padre' ? 'fila-padre' :
        rowData.Tipo === 'Hijo' ? 'fila-hijo' :
        rowData.Tipo === 'Nieto' ? 'fila-nieto' : 'fila-padre'" 
      [ttRow]="rowNode">
      
      <!-- Nombre con toggler -->
      <td *ngIf="rowData.Editable == false" style="width: 30%">
        <p-treeTableToggler [rowNode]="rowNode" />
        <span>{{ rowData.name }}</span>
      </td>
      
      <td *ngIf="rowData.Editable == true && rowData.Tipo == 'Hijo'" style="width: 30%">
        <div style="margin-top: -35px; margin-left: 50px">
          <p-treeTableToggler [rowNode]="rowNode" />
          <p-floatLabel>
            <input
              (keyup.enter)="guardarHijo(rowData)"
              class="text-center custom-input" pInputText id="username" [(ngModel)]="rowData.Alias" />
            <label for="username">Nombre cuenta hijo</label>
          </p-floatLabel>
        </div>
      </td>
      
      <td *ngIf="rowData.Editable == true && rowData.Tipo == 'Nieto'" style="width: 30%">
        <div style="margin-top: -35px; margin-left: 70px">
          <p-treeTableToggler [rowNode]="rowNode" />
          <p-floatLabel>
            <input 
              (keyup.enter)="guardarHijo(rowData)"
              class="text-center custom-input" pInputText id="username" [(ngModel)]="rowData.Alias" />
            <label for="username">Nombre cuenta nieto</label>
          </p-floatLabel>
        </div>
      </td>

      <!-- Botón Añadir -->
      <td *ngIf="rowData.Tipo == 'Padre'" class="text-center" style="width: 12%">
        <button
          [disabled]="rowData.Customizable==false"
          (click)="AddCuentaHijo(rowData.idPadre, rowData.idAbuelo, rowData.idCateg)"
          pButton
          severity="info"
          type="button"
          label="Hijo"
          icon="pi pi-plus"
          class="p-button-rounded p-button-text p-button-sm"
        ></button>
      </td>
      
      <td *ngIf="rowData.Tipo == 'Nieto'" class="text-center" style="width: 12%">
        <!-- Celda vacía para mantener la alineación -->
      </td>
      
      <td *ngIf="rowData.Tipo == 'Hijo'" class="text-center" style="width: 12%">
        <button
          pButton
          type="button"
          severity="warning"
          (click)="AddCuentaNieto(rowData)"
          [disabled]="(rowData.Editable == true || rowData.CuentasNieto==false) || rowData.Prefijo!='1.2.2'"
          icon="pi pi-plus"
          label="Nieto"
          class="p-button-rounded p-button-text p-button-sm"
        ></button>
      </td>
      
      <td *ngIf="rowData.Tipo == 'Abuelo'" class="text-center" style="width: 12%">
        Desglose para ver las cuentas
      </td>

      <!-- Columna Proyectos -->
      <td class="text-center" style="width: 12%">
        <!-- Aquí va el contenido de proyectos según el tipo de fila -->
        <span *ngIf="rowData.Tipo == 'Abuelo' || rowData.Tipo == 'Padre'">-</span>
       
        <span *ngIf=" (rowData.Tipo == 'Hijo'|| rowData.Tipo == 'Nieto') && (rowData.CuentaFija==false)">
          <button
          [disabled]="rowData.Editable == true"
          type="button" 
          (click)="showDialogProyecto(rowData.ProyectosSeleccionados,rowData)" 
          style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
          class="btn btn-success">Ver Proyectos</button>
        </span>
        <span *ngIf=" (rowData.Tipo == 'Hijo'|| rowData.Tipo == 'Nieto') && (rowData.CuentaFija==true)">
          Todos
        </span>
        <!-- Agrega más lógica según necesites -->
      </td>

      <!-- Columna Sucursales -->
      <td class="text-center" style="width: 12%">
        <!-- Aquí va el contenido de sucursales según el tipo de fila -->
        <span *ngIf="rowData.Tipo == 'Abuelo' || rowData.Tipo == 'Padre'">-</span>
        <span *ngIf=" (rowData.Tipo == 'Hijo'|| rowData.Tipo == 'Nieto') && (rowData.CuentaFija==false)">
          <button type="button" 
          [disabled]="rowData.Editable == true"
          (click)="showDialogSucursal(rowData.SucursalesSeleccionadas,rowData)" 
          style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
          class="btn btn-info">Ver Sucursales</button>
        </span>
        <span *ngIf=" (rowData.Tipo == 'Hijo'|| rowData.Tipo == 'Nieto') && (rowData.CuentaFija==true)">
          Todas
        </span>
        <!-- Agrega más lógica según necesites -->
      </td>

      <!-- Botón editar -->
      <td *ngIf="(rowData.Tipo == 'Nieto' || rowData.Tipo == 'Hijo' || rowData.Tipo == 'Padre') && rowData.Editable == false"
          style="width: 17%" class="text-center">
        <button
          pButton
          type="button"
          [disabled]="rowData.Customizable==false 
            || rowData.idCateg=='1.1' 
            || rowData.idCateg=='1.2'                
            || rowData.idCateg=='2.1' 
            || rowData.idCateg=='2.2'                
            || rowData.idCateg=='3.1' 
            || rowData.idCateg=='3.2' 
            || rowData.Prefijo=='1.2.2' 
            || rowData.Prefijo=='1.2.1.1' 
            || rowData.Prefijo=='1.2.1.2' 
            || rowData.Prefijo=='1.2.1.3' 
            || rowData.Prefijo=='1.1.1'"
          icon="pi pi-pencil"
          (click)="rowData.Editable = !rowData.Editable"
          class="p-button-rounded p-button-text p-button-sm"
        ></button>
      </td>
      
      <!-- Botón guardar -->
      <td *ngIf="(rowData.Tipo == 'Nieto' || rowData.Tipo == 'Hijo' || rowData.Tipo == 'Padre') && rowData.Editable == true" 
          style="width: 17%" class="text-center">
        <button
          pButton
          pTooltip="Confirm to proceed" 
          showDelay="1000" 
          hideDelay="300" 
          (click)="guardarHijo(rowData)"
          type="button"
          icon="pi pi-check"
          class="p-button-rounded editar p-button-text p-button-sm"
        ></button>
      </td>

      <td *ngIf="rowData.Tipo == 'Abuelo'" class="text-center" style="width: 17%"> 
        <!-- Celda vacía para mantener la alineación -->
      </td>

      <!-- Botón borrar -->
      <td *ngIf="rowData.Tipo == 'Nieto' || rowData.Tipo == 'Hijo' || rowData.Tipo=='Padre'" 
          class="text-center" style="width: 17%">
        <button 
          [disabled]="rowData.Customizable==false 
            || rowData.idCateg=='1.1' 
            || rowData.idCateg=='1.2'                
            || rowData.idCateg=='2.1' 
            || rowData.idCateg=='2.2'                
            || rowData.idCateg=='3.1' 
            || rowData.idCateg=='3.2'                
            || rowData.Prefijo=='1.2.2' 
            || rowData.Prefijo=='1.2.1.1' 
            || rowData.Prefijo=='1.2.1.2' 
            || rowData.Prefijo=='1.2.1.3' 
            || rowData.Prefijo=='1.1.1'"
          pButton type="button" icon="pi pi-trash" 
          class="p-button-rounded p-button-text p-button-danger p-button-sm">
        </button>
      </td>
      
      <td *ngIf="rowData.Tipo == 'Abuelo'" class="text-center" style="width: 17%">
        <!-- Celda vacía para mantener la alineación -->
      </td>
    </tr>
  </ng-template>
</p-treeTable>
    </app-card>
  </div>
</div>

<p-dialog 
        header="Proyectos en esta cuenta" 
        (onHide)="guardarEdicionProyecto()"
        [modal]="true" 
        [(visible)]="visibleProyecto" 
        [style]="{ width: '60rem',height:'20rem' }" 
        [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" 
        [maximizable]="true">
        <ng-select loadingText="Cargando cuentas..." 
        (change)="editarProyectos()"
        notFoundText="No hay sub cuentas disponibles" class="mt-1"
          [items]="Proyectos" [multiple]="true" [closeOnSelect]="false" [searchable]="true" bindLabel="Nombre"
          placeholder="Seleccione un proyecto" [(ngModel)]="this.ProyectosSeleccionadosCuenta">
        </ng-select>
  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
    <button type="button" (click)="guardarEdicionProyecto()" class="btn btn-success mt-2">Guardar</button>
  </div>      
      
</p-dialog>

<p-dialog 
        header="Sucursales en esta cuenta" 
        (onHide)="guardarEdicionSucursal()"
        [modal]="true" 
        [(visible)]="visibleSucursal" 
        [style]="{ width: '60rem',height:'20rem' }" 
        [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" 
        [maximizable]="true">
        <ng-select loadingText="Cargando cuentas..." 
        (change)="editarSucursales()"
        notFoundText="No hay sucursales disponibles" class="mt-1"
          [items]="Sucursales" [multiple]="true" [closeOnSelect]="false" [searchable]="true" bindLabel="Nombre"
          placeholder="Seleccione una sucursal" [(ngModel)]="this.SucursalesSeleccionadasCuenta">
        </ng-select>
  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
    <button type="button" (click)="guardarEdicionSucursal()" class="btn btn-success mt-2">Guardar</button>
  </div>      
      
</p-dialog>


